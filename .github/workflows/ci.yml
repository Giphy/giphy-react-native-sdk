name: 'CI'

on:
  push:
    branches: [ 'main' ]
    tags: [ 'v*' ]
  pull_request:
    branches: [ 'main' ]

concurrency:
  group: ${{ github.workflow }}-${{ github.event_name }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read

jobs:
  lint:
    name: Lint
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ‘€ Checkout
        uses: actions/checkout@v3
        with:
          persist-credentials: false

      - name: ğŸ› ï¸ Set up environment
        uses: ./.github/actions/setup

      - name: ğŸ•µï¸ Lint
        run: yarn lint

      - name: ğŸ‘® Check Types
        run: yarn typescript

  check-licenses:
    name: Check Licenses
    runs-on: macos-latest
    steps:
      - name: ğŸ‘€ Checkout
        uses: actions/checkout@v3
        with:
          persist-credentials: false

      - name: ğŸ› ï¸ Set up environment
        uses: ./.github/actions/setup
        with:
          cocoa-pods: true
          jdk: true

      - name: ğŸ­ Generate Licenses
        run: yarn licenses:generate

      - name: ğŸ‘® Check Licenses
        run: yarn licenses:check
        env:
          LICENSE_CATEGORIES_LOCATION: ${{ secrets.LICENSE_CATEGORIES_LOCATION }}
          LICENSE_PROJECT_LOCATION: ${{ secrets.LICENSE_PROJECT_LOCATION }}
